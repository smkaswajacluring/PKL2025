<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>PKL TKJ 2025/2026</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">
  <link rel="icon" type="image/x-icon" href="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">
  <link rel="shortcut icon" href="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">
  <link rel="icon" type="image/png" sizes="48x48" href="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">
  <link rel="icon" type="image/png" sizes="64x64" href="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png">

  <link rel="stylesheet" href="https://smkaswajacluring.github.io/PKL2025/node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://smkaswajacluring.github.io/PKL2025/node_modules/@fortawesome/fontawesome-free/css/all.min.css">

  <style type="text/css">
    * {
      font-family: 'Courier New', Courier, monospace;
    }

    hr {
      border-color: var(--bs-dark);
      opacity: 1;
      margin: .5rem auto;
    }

    p,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 0;
      padding: 0;
    }

    .text-carousel {
      border-radius: .5rem;
      margin: 0px !important;
      padding: 15px 15px 0px 15px;
      background-color: rgba(var(--bs-dark-rgb), .6);
    }

    .card-img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      background-position: center;
    }

    .icon {
      font-size: 80%;
    }

    .icon>i {
      width: 15px;
      text-align: start;
    }

    ul>li>a.dropdown-item {
      cursor: pointer;
    }

    .dropdown-menu.show {
      width: 80%;
    }
  </style>
</head>

<body class="bg-light">

  <div>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <div class="container-fluid">
        <div class="d-flex align-items-center py-1">
          <div class="p auto"><img src="https://smkaswajacluring.github.io/PKL2025/assets/images/LOGO.png" alt="LOGO" width="45"></div>
          <div class="p flex-fill"><a class="navbar-brand ps-3 fw-bolder">PKL TKJ 2025/2026</a></div>
        </div>
      </div>
    </nav>
  </div>

  <div>
    <div id="myCarousel" class="carousel slide pt-5 pb-2" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="2"></button>
      </div>

      <div class="carousel-inner">
        <div class="carousel-item active"><img src="https://smkaswajacluring.github.io/PKL2025/assets/images/1.jpg" alt="images1" class="d-block w-100"></div>
        <div class="carousel-item"><img src="https://smkaswajacluring.github.io/PKL2025/assets/images/2.jpg" alt="images1" class="d-block w-100"></div>
        <div class="carousel-item"><img src="https://smkaswajacluring.github.io/PKL2025/assets/images/3.jpg" alt="images1" class="d-block w-100"></div>
      </div>

      <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
        <span class="visually-hidden">Previous</span>
      </button>

      <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
  </div>

  <div>
    <div class="container">
      <div class="dropdown mt-2">
        <button class="btn btn-dark dropdown-toggle w-100" type="button" id="dropdownMenuButton1"
          data-bs-toggle="dropdown" aria-expanded="false">
          PILIH TIPE INFORMASI
        </button>
        <ul class="dropdown-menu shadow" aria-labelledby="dropdownMenuButton1">
          <li><a class="dropdown-item">PENGISIAN FORMULIR</a></li>
          <li>
            <hr>
          </li>
          <li><a class="dropdown-item">RAIHAN SUHARTONO</a></li>
          <li><a class="dropdown-item">MUHAMMAD ROFIQ NUR FAJRI</a></li>
          <li><a class="dropdown-item">MARCHELO DIMAS SAPUTRA</a></li>
          <li><a class="dropdown-item">HENKY EKA SAPUTRA</a></li>
          <li><a class="dropdown-item">M RIZKY ADI SAPUTRA</a></li>
          <li><a class="dropdown-item">BAYU TIRTA ARUM</a></li>
          <li><a class="dropdown-item">AHMAD TRIO RAMA DHANI</a></li>
          <li><a class="dropdown-item">AGUS HAYDAR ALI</a></li>
          <li>
            <hr>
          </li>
          <li><a class="dropdown-item">REKAP TOTAL</a></li>
        </ul>
      </div>

      <div id="main-data" style="display: none;">
        <div class="row">
          <div class="col-12 pt-3">
            <h4 class="fw-bolder" id="data-title"></h4>
            <hr>
          </div>
        </div>

        <div class="row justify-content-center" id="loading">
          <div class="col-12 text-center mt-4">
            <div class="spinner-border" role="status"></div>
          </div>
          <div class="col-12 text-center mt-2">
            <span>Sedang memuat informasi...</span>
          </div>
        </div>

        <div class="row" id="data-container">
          <!--  -->
        </div>
      </div>
    </div>
  </div>

  <script src="https://smkaswajacluring.github.io/PKL2025/node_modules/jquery/dist/jquery.min.js"></script>
  <script src="https://smkaswajacluring.github.io/PKL2025/node_modules/@popperjs/core/dist/umd/popper.min.js"></script>
  <script src="https://smkaswajacluring.github.io/PKL2025/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

  <script type="text/javascript">
    const container = document.getElementById('data-container');

    function parseCSV(text) {
      const normalizedText = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
      const lines = normalizedText.split('\n').filter(line => line.trim() !== '');
      if (lines.length <= 1) return [];
      const dataRows = lines.slice(1);
      const records = [];

      dataRows.forEach(line => {
        const cells = line.split(',');
        console.log(cells.length);
        if (cells.length >= 8) {
          const cleanedCells = cells.map(cell => cell.trim());
          records.push(cleanedCells);
        }
      });
      return records;
    }

    function extractDriveId(url) {
      return url
        .replace("https://drive.google.com/open?id=", "")
        .replace("https://drive.google.com/open? id=", "")
        .trim();
    }

    async function fetchAndRenderData(sheet, gid) {
      const sheet_url = `https://docs.google.com/spreadsheets/d/e/${sheet}/pub?gid=${gid}&single=true&output=csv`;
      try {
        const response = await fetch(sheet_url);
        if (!response.ok) {
          throw new Error(`HTTP Error! Status: ${response.status}.`);
        }

        const text = await response.text();
        const records = parseCSV(text);
        container.innerHTML = '';

        records.sort((a, b) => {
          const tanggalA = new Date(`${a[1]} ${a[2]}`);
          const tanggalB = new Date(`${b[1]} ${b[2]}`);
          return tanggalB - tanggalA;
        });

        records.forEach(cells => {
          const tanggal = cells[1] || '';
          const jam = cells[2] || '';
          const tanggalJam = `${tanggal}`.trim() || 'Tanggal Tidak Ada';

          const email = cells[3] || 'Email Tidak Ada';
          const nama = cells[4] || 'Nama Tidak Ada';
          const judul = cells[5] || 'Judul Tidak Ada';
          const detail = cells[6] || 'Detail Tidak Ada';
          const fotoUrlLengkap = cells[7] || '';

          const driveId = extractDriveId(fotoUrlLengkap);
          let fotoSrc = driveId
            ? `https://drive.google.com/thumbnail?id=${driveId}`
            : 'https://via.placeholder.com/340x200?text=Tidak+Ada+Foto';

          const cardHtml = `
          <div class="col-12 mt-3">
            <div class="card h-100">
              <img src="${fotoSrc}" alt="Foto Kegiatan: ${judul}" class="card-img">
              <div class="card-body shadow rounded">
                <div class="icon"><i class="fa fa-user"></i> <strong>${nama}</strong></div>
                <div class="icon"><i class="fa fa-calendar"></i> ${tanggalJam}</div>
                <div class="icon"><i class="fa fa-envelope"></i> ${email}</div>
                <hr>
                <p class="text-justify fw-bolder">${judul}</p>
                <p class="text-justify" style="font-size: 80%;">${detail}</p>
              </div>
            </div>
          </div>`;
          container.innerHTML += cardHtml;
          $("#loading").hide();
        });

        if (records.length === 0) {
          $("#loading").hide();
          container.innerHTML = '<p class="loading">Tidak ada data yang ditemukan di Spreadsheet</p>';
        }

      } catch (error) {
        $("#loading").hide();
        console.error('Gagal mengambil atau memproses data:', error);
        container.innerHTML = `<p class="loading" style="color:red;">Gagal memuat data. Pesan: ${error.message}</p>`;
      }
    }

    const data_url = {
      "RAIHAN SUHARTONO": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "MUHAMMAD ROFIQ NUR FAJRI": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "MARCHELO DIMAS SAPUTRA": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "HENKY EKA SAPUTRA": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "M RIZKY ADI SAPUTRA": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "BAYU TIRTA ARUM": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "AHMAD TRIO RAMA DHANI": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "AGUS HAYDAR ALI": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_",
      "REKAP TOTAL": "2PACX-1vTWO3G4cYnvIZbVVMakXv84wcPHWXrAMtrewTmLHKSjbrT_ichG6oWsKINGX1jNyWlUR87jbslkrEh_"
    }

    const data_gid = {
      "RAIHAN SUHARTONO": "1121193528",
      "MUHAMMAD ROFIQ NUR FAJRI": "1309896398",
      "MARCHELO DIMAS SAPUTRA": "1674852692",
      "HENKY EKA SAPUTRA": "1888268587",
      "M RIZKY ADI SAPUTRA": "555783458",
      "BAYU TIRTA ARUM": "260209252",
      "AHMAD TRIO RAMA DHANI": "1936587578",
      "AGUS HAYDAR ALI": "1424361238",
      "REKAP TOTAL": "1087238064"
    }

    $(".dropdown-item").each(function () {
      $(this).click(function () {
        $("#loading").show();
        $("#main-data").show();
        container.innerHTML = "";
        const name = $(this).html();

        if (name == "PENGISIAN FORMULIR") {
          window.location.href = "https://forms.gle/vjTWf9V5q8vbKb539";
          return;
        }

        $("#data-title").html(name);
        console.log(data_url[name], data_gid[name]);
        fetchAndRenderData(data_url[name], data_gid[name]);
      });
    });

    $(document).ready(function () {
      $("#loading").show();
      $("#main-data").show();
      container.innerHTML = "";
      const name = "REKAP TOTAL";

      $("#data-title").html(name);
      console.log(data_url[name], data_gid[name]);
      fetchAndRenderData(data_url[name], data_gid[name]);
    });
  </script>

</body>

</html>